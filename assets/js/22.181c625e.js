(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{420:function(e,t,n){"use strict";n.r(t);var o=n(42),r=Object(o.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"inbound-smtp-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#inbound-smtp-server"}},[e._v("#")]),e._v(" Inbound SMTP Server")]),e._v(" "),n("p",[n("em",[e._v("NotifyBC")]),e._v(" implemented a custom inbound SMTP server based on Nodemailer "),n("a",{attrs:{href:"https://nodemailer.com/extras/smtp-server/",target:"_blank",rel:"noopener noreferrer"}},[e._v("SMTP Server"),n("OutboundLink")],1),e._v(" to handle")]),e._v(" "),n("ul",[n("li",[n("RouterLink",{attrs:{to:"/docs/config-listUnsubscribeByEmail/"}},[e._v("list-unsubscribe by email")])],1),e._v(" "),n("li",[n("RouterLink",{attrs:{to:"/docs/config-notificationBounce/"}},[e._v("notification bounce")])],1)]),e._v(" "),n("p",[e._v("In order for the emails from internet to reach the SMTP server, a host\nwhere one of the following servers should be listening on port 25\nopen to internet")]),e._v(" "),n("ol",[n("li",[n("em",[e._v("NotifyBC")]),e._v(", if it can be installed on such internet-facing host directly; otherwise,")]),e._v(" "),n("li",[e._v("a tcp proxy server, such as nginx with stream proxy module that can proxy tcp port 25 traffic to backend "),n("em",[e._v("NotifyBC")]),e._v(" instances.")])]),e._v(" "),n("p",[e._v("Regardless which above option is chosen, you need to config "),n("em",[e._v("NotifyBC")]),e._v(" inbound SMTP server by adding following static config "),n("em",[e._v("inboundSmtpServer")]),e._v(" to file "),n("em",[e._v("/src/config.local.js")])]),e._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[e._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n  inboundSmtpServer"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    enabled"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    domain"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'host.foo.com'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    listeningSmtpPort"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("25")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    options"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("where")]),e._v(" "),n("ul",[n("li",[n("em",[e._v("enabled")]),e._v(" enables/disables the inbound SMTP server with default to "),n("em",[e._v("true")]),e._v(".")]),e._v(" "),n("li",[n("em",[e._v("domain")]),e._v(" is the internet-facing host domain. It has no default so "),n("strong",[e._v("must be set")]),e._v(".")]),e._v(" "),n("li",[n("em",[e._v("listeningSmtpPort")]),e._v(" should be set to 25 if option 1 above is chosen. For options 2, "),n("em",[e._v("listeningSmtpPort")]),e._v(" can be set to any opening port. On Unix, "),n("em",[e._v("NotifyBC")]),e._v(" has to be run under "),n("em",[e._v("root")]),e._v(" account to bind to port 25. If missing, "),n("em",[e._v("NotifyBC")]),e._v(" will randomly select an available port upon launch which is usually undesirable so it "),n("strong",[e._v("should be set")]),e._v(".")]),e._v(" "),n("li",[e._v("optional "),n("em",[e._v("options")]),e._v(" object defines the behavior of "),n("a",{attrs:{href:"https://nodemailer.com/extras/smtp-server/#step-3-create-smtpserver-instance",target:"_blank",rel:"noopener noreferrer"}},[e._v("Nodemailer SMTP Server"),n("OutboundLink")],1),e._v(".")])]),e._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[e._v("Inbound SMTP Server on OpenShift")]),e._v(" "),n("p",[e._v("OpenShift deployment template deploys an inbound SMTP server. Due to the limitation that OpenShift can only expose port 80 and 443 to external, to use the SMTP server, you have to setup a TCP proxy server (i.e. option 2). The inbound SMTP server is exposed as ${INBOUND_SMTP_DOMAIN}:443 , where ${INBOUND_SMTP_DOMAIN} is a template parameter which in absence, a default domain will be created. Configure your TCP proxy server to route traffic to ${INBOUND_SMTP_DOMAIN}:443 over TLS.")])]),e._v(" "),n("h2",{attrs:{id:"tcp-proxy-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tcp-proxy-server"}},[e._v("#")]),e._v(" TCP Proxy Server")]),e._v(" "),n("p",[e._v("If "),n("em",[e._v("NotifyBC")]),e._v(" is not able to bind to port 25 that opens to internet, perhaps\ndue to firewall restriction, you can setup a TCP Proxy Server such as Nginx with "),n("a",{attrs:{href:"http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ngx_stream_proxy_module"),n("OutboundLink")],1),e._v(". For example, the following nginx config will proxy SMTP traffic from port 25 to a "),n("em",[e._v("NotifyBC")]),e._v(" inbound SMTP server running on OpenShift")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("stream {\n    server {\n        listen 25;\n        proxy_pass ${INBOUND_SMTP_DOMAIN}:443;\n        proxy_ssl on;\n        proxy_ssl_verify off;\n        proxy_ssl_server_name on;\n        proxy_connect_timeout 10s;\n    }\n}\n")])])]),n("p",[e._v("Replace "),n("em",[e._v("${INBOUND_SMTP_DOMAIN}")]),e._v(" with the inbound SMTP server route domain.")])])}),[],!1,null,null,null);t.default=r.exports}}]);